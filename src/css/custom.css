/* DESIGN
   ------------------------------------------
   * This configuration overrides the default Infima/Docusaurus theme
   * to achieve a "UX Engineer System" aesthetic

   * The architecture follows a "Theme-Driven Variables" system:
   * - :root contains the Light mode (default) and structural variables
   * - [data-theme='dark'] contains only the necessary overrides for Dark mode
   * - Layout logic focuses on Gestalt principles (spacing, grouping)
   * and WCAG Accessibility (contrast ratios).

   * Architectural decision: Why I skipped @layer (for now)
   * I evaluated using CSS Cascade Layers to modernize the architecture
   * However, Docusaurus currently relies on unlayered styles. Since the CSS
   * Specification dictates that unlayered styles always beat layered ones,
   * using them would have forced me into a "specificity war" fought with
   * `!important`
   * I chose a pragmatic path: standard unlayered CSS. It simply loads last
   * and overrides the defaults naturally.

   * Key Technical choices:
   * - "Surgical gradient": Used instead of borders for the sidebar separator
   *    to respect internal padding without layout shifts.
   * - "Token overrides": Specific targeting of PrismJS syntax tokens
   *    to ensure code readability across both color schemes.
*/


/* UNIVERSAL & LIGHT MODE (Default Variables) */

:root {
    /* Color Palette (Coffee & Sand) */
    --ifm-color-primary: #614a33;
    --ifm-color-primary-dark: #7d5f40;
    --ifm-color-primary-darker: #76593c;
    --ifm-color-primary-darkest: #614a32;
    --ifm-color-primary-light: #a68563;
    --ifm-color-primary-lighter: #b09170;
    --ifm-color-primary-lightest: #cfb89e;

    /* Base UI & Fonts */
    --ifm-font-family-base: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
    --ifm-global-radius: 20px;

    /* Layout Backgrounds & Borders */
    --frame-background: #9B795A;
    --ifm-background-color: #E4D6C9;
    --card-border-color: #6b6053;
    --ifm-color-content: #000000;
    --ifm-navbar-background-color: #E4D6C9;
    --ifm-navbar-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.18);
    --button-border-color: #322d26;
    --button-border-color-hover: #ae9a83;

    /* Sidebar & Navigation */
    --sidebar-separator: rgba(15, 33, 41, 0.14);
    --ifm-toc-border-color: var(--sidebar-separator);
    --ifm-menu-color: #574c45;       /* Inactive links (contrast fix) */
    --ifm-toc-link-color: #574c45;   /* TOC Inactive links */

    /* Data Tables */
    --ifm-table-border-color: #a1907b; 
    --ifm-table-stripe-background: rgba(0, 0, 0, 0.05);

    /* Breadcrumbs (Navigation Path) */
    --ifm-breadcrumb-item-background-active: rgba(0, 0, 0, 0.06);
    --ifm-breadcrumb-color-active: var(--ifm-color-primary-darkest);

    /* Search Bar (Light Mode) */
    --search-background: #d9ccbe;
    --search-text: #423223;
    --search-border-color: rgba(97, 74, 51, 0.3);
    --search-icon-url: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%23614a33" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="23" y1="23" x2="16.65" y2="16.65"></line></svg>');
    
    /* Syntax Highlighting (Light Mode specific tokens) */
    --code-token-cyan-fix: #005a75; /* Dark Petrol (replaces unreadable Cyan) */
    --code-token-doctype: #393a34;  /* Dark Grey (fixes Italic Doctype) */
}


/* DARK MODE (Overrides) */

[data-theme='dark'] {
    /* Color Palette (Warm Night) */
    --ifm-color-primary: #D4A373;
    --ifm-color-primary-dark: #be8e5e;
    --ifm-color-primary-darker: #b38556;
    --ifm-color-primary-darkest: #946d45;
    --ifm-color-primary-light: #decba4;
    --ifm-color-primary-lighter: #eaddc5;
    --ifm-color-primary-lightest: #f5efe2;

    /* Layout Backgrounds */
    --frame-background: #140A07;
    --ifm-background-color: #322620;
    --card-border-color: #574C43;
    --card-border-color-hover: #998874;
    --ifm-color-content: #FFFFFF;
    --ifm-navbar-background-color: #322620;
    --ifm-navbar-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.35); /* Dark Mode adjustment (the black shadow is less visible, so the opacity has been increased) */
    --button-border-color: #a7805a;
    --button-border-color-hover: #716454;

    /* Sidebar & Navigation */
    --sidebar-separator: rgba(90, 124, 155, 0.35);
    --ifm-toc-border-color: var(--sidebar-separator);
    --ifm-menu-color: #b9a193;
    --ifm-toc-link-color: #b9a193;

    /* Breadcrumbs */
    --ifm-breadcrumb-item-background-active: rgba(255, 255, 255, 0.1);
    --ifm-breadcrumb-color-active: var(--ifm-color-primary-lightest);

    /* Search Bar (Dark Mode) */
    --search-background: #322720;
    --search-text: #ffeac1;
    --search-border-color: rgba(222, 203, 164, 0.2);
    --search-icon-url: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%23decba4" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="23" y1="23" x2="16.65" y2="16.65"></line></svg>');
    
    /* Syntax Highlighting (Dark Mode specific tokens) */
    --code-token-keyword-fix: #d4aaff; /* Light Lavender (for contrast) */
}


/* GLOBAL LAYOUT RESET */

html, body {
    background-color: var(--frame-background);
    height: 100%;
}

#__docusaurus {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    background-color: var(--frame-background);
}


/* COMPONENTS: Navbar & Main Container */

.navbar {
    margin: 16px 16px 0 16px;
    border-radius: var(--ifm-global-radius);
    border: 1px solid var(--card-border-color);
    width: auto;

    /* NAVBAR 3D ELEVATION FIX */
    /* I added a very soft and diffused shadow to give a subtle sense of floating.
    I focused on lightness, as in the rest of the CSS, in order to avoid putting
    unnecessary load on the GPU.
    The effect is intentionally almost imperceptible on the main screen, but becomes
    more noticeable as you scroll down.
    */
    box-shadow: var(--ifm-navbar-shadow);
}

.navbar__title {
    font-weight: 750;
}

.main-wrapper {
    margin: 16px;
    background-color: var(--ifm-background-color);
    border-radius: var(--ifm-global-radius);
    border: 1px solid var(--card-border-color);
    padding-top: 25px; /* Restores top spacing after removing overflow:hidden */
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

.footer {
    background-color: transparent;
    border-top: none;
}

.pagination-nav__link {
    border: 1px solid var(--button-border-color);
}

.pagination-nav__link:hover {
    border-color: var(--button-border-color-hover);
}

/* COMPONENTS: Search Bar */

.navbar__search-input {
    background-color: var(--search-background) !important;
    color: var(--search-text) !important;
    border: 2.5px solid var(--search-border-color) !important;
    border-radius: var(--ifm-global-radius) !important;
    transition: all 0.2s ease;
    background-image: var(--search-icon-url) !important; 
}

/* Placeholder styling */
.navbar__search-input::placeholder {
    color: var(--search-text) !important;
    opacity: 0.6;
}


/* COMPONENTS: Sidebar (Left Navigation) */

.menu {
    padding-top: 1.5rem; 
}

.menu__list-item {
    border-bottom: 2px solid var(--sidebar-separator);
    margin-bottom: 4px;
    padding-bottom: 2.5px;
}

.menu__list-item:last-child {
    border-bottom: none;
    margin-bottom: 0rem;
}

.menu__link {
    border-radius: 8px;
}

/* Active State Logic: Syncs Sidebar style with Breadcrumbs */
.menu__link--active {
    background-color: var(--ifm-breadcrumb-item-background-active) !important;
    color: var(--ifm-breadcrumb-color-active) !important;
    font-weight: 600;
}

[data-theme='dark'] .menu__link--active {
    background-color: var(--ifm-breadcrumb-item-background-active) !important;
    color: var(--ifm-breadcrumb-color-active) !important;
}

/* Macro Sections (Featured, Path, Vademecum) */
/* These act as static headers: no highlight, fixed color */
.theme-doc-sidebar-item-category-level-1 {
    margin-bottom: 0.95rem; /* Gestalt principle: spacing indicates grouping */
}

.theme-doc-sidebar-item-category-level-1 > div > .menu__link,
.theme-doc-sidebar-item-category-level-1 > div > .menu__link--active {
    color: var(--ifm-menu-color) !important;     /* Force neutral color */
    background-color: transparent !important;    /* No background */
    font-weight: 600 !important;                 /* Fixed weight */
    font-size: 1.1rem;
    letter-spacing: 0.01em;
}

/* Clean up spacing for the very last item */
.menu__list > .theme-doc-sidebar-item-category-level-1:last-child {
    margin-bottom: 0;
}

/* Exception for Vademecum: Keep the separator line visible */
.menu__list > .theme-doc-sidebar-item-category-level-1:last-child {
    border-bottom: 2px solid var(--sidebar-separator);
    padding-bottom: 4px;
    margin-bottom: 0;
}

/* Sidebar Separator (The Surgical Gradient) */
/* I used a gradient instead of a border to respect top padding without layout shift */
aside[class^='theme-doc-sidebar-container'] {
    border-right: none;

    background-image: linear-gradient(
        to bottom,
        transparent 0px,
        transparent 54px, /* Start: aligns visually with the content top */
        var(--sidebar-separator) 54px, 
        var(--sidebar-separator) calc(100% - 19px), /* Body: the actual line */
        transparent calc(100% - 19px) /* End: fades out before bottom */
    );
    background-position: right top;
    background-size: 1px 100%;
    background-repeat: no-repeat;
}


/* COMPONENTS: Content & Navigation (Right/Center) */

/* Breadcrumbs */
.breadcrumbs__item--active > .breadcrumbs__link {
    background-color: var(--ifm-breadcrumb-item-background-active);
    color: var(--ifm-breadcrumb-color-active);
    font-weight: 600;
}

/* Table of Contents (Right Sidebar) */
.table-of-contents {
    padding-top: 1.5rem; 
    font-size: 0.95rem;
}

.table-of-contents__link--active {
    font-weight: 750;
    color: var(--ifm-color-primary);
}

/* Code Block Highlighting */
.docusaurus-highlight-code-line {
    background-color: rgba(0, 0, 0, 0.1);
    display: block;
    margin: 0 calc(-1 * var(--ifm-pre-padding));
    padding: 0 var(--ifm-pre-padding);
}

[data-theme='dark'] .docusaurus-highlight-code-line {
    background-color: rgba(0, 0, 0, 0.3);
}


/* ACCESSIBILITY & SYNTAX (Token Overrides) */
/* Forces readable colors for specific code tokens based on theme */

/* LIGHT MODE: Fixes low contrast Cyan and Italic Doctype */
html[data-theme='light'] code span.token.attr-name,
html[data-theme='light'] code span.token.builtin,
html[data-theme='light'] code span.token.char,
html[data-theme='light'] code span.token.inserted,
html[data-theme='light'] code span.token.selector,
html[data-theme='light'] code span.token.string,
html[data-theme='light'] code span.token.property,
html[data-theme='light'] code span.token.number,
html[data-theme='light'] code span.token.boolean,
html[data-theme='light'] code span.token.variable,
html[data-theme='light'] code span.token.constant {
    color: var(--code-token-cyan-fix) !important; 
}

html[data-theme='light'] code span.token.doctype {
    color: var(--code-token-doctype) !important;
    font-style: normal !important;
}

/* DARK MODE: Brightens obscure colors for better contrast */
html[data-theme='dark'] code span.token.keyword,
html[data-theme='dark'] code span.token.operator,
html[data-theme='dark'] code span.token.variable {
    color: var(--code-token-keyword-fix) !important; 
    font-style: normal !important;
}

/* Footer */
.footer__links {
  display: flex;
  justify-content: flex-start; /* Anchors the navigation map to the left edge */
  padding-left: 2rem; 
  width: 100%;
}

.footer__title {
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  opacity: 0.6;
  margin-bottom: 1rem;
}

/* Copyright */
.footer__bottom {
  text-align: left;   
  padding-left: 2rem;
  margin-top: 2rem;
  opacity: 0.6;
}

/* MOBILE UX: Dynamic title fade & collapse */

/*
 I tried to fix the issue where the search bar was collapsing
 into the site title on very narrow devices by introducing an
 animation. This way, the experience no longer feels like “something
 is being taken away because there’s a problem,” but rather like “something
 is being added through an animation.”
*/
@media screen and (max-width: 411px) {

    .navbar__title {
        font-size: 1.2rem;
        line-height: 2; /* I set line-height to 2 because visual testing showed this matches the hamburger menu height perfectly, ensuring vertical centering */
        transition: opacity 0.3s ease, max-width 0.3s ease, margin 0.3s ease;
        opacity: 1;
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
    }

    .navbar:has(.navbar__search-input:focus) .navbar__title {
        opacity: 0;
        max-width: 0;
        margin: 0;
        pointer-events: none;
    }

}


/* SAFARI & MOBILE SEARCH FIX */

/*
I noticed a very annoying bug on iOS: after tapping on the search bar,
the screen dims and the search results become unclickable.
I fixed it by applying a very high z-index (99999)
*/
@media (max-width: 996px) { /* Here we force the search container above EVERYTHING (including the fixed navbar) */
  .DocSearch-Container {
    position: fixed !important;
    inset: 0 !important;
    z-index: 99999 !important;
    height: 100dvh !important;
  }

  .DocSearch-Modal {
    margin: 0 !important;
    width: 100% !important;
    height: 100% !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    -webkit-overflow-scrolling: touch !important; /* This allows internal scrolling on iOS */
  }
  
  body.DocSearch--active .navbar {
    opacity: 0 !important;          /* Makes it invisible */
    pointer-events: none !important; /* It also makes it touchless (clicks pass through) */
  }

    /* Here we make code blocks smaller on mobile to get a better overall view */
    .theme-code-block pre,
    .theme-code-block code,
    .prism-code {
    font-size: 0.75rem !important; 
    line-height: 1.4 !important; /* We also slightly reduce line height to make the layout more vertically compact */
    -webkit-text-size-adjust: 100%; /* We disable iOS automatic text zooming */
}

}


/* FOOTER CONTRAST FIX (Goal: 100/100 A11y) */
/* The default grey links on dark background fail WCAG contrast ratio. */
.footer__link-item {
    color: #e0e0e0; /* Almost white (High Contrast) */
    opacity: 1;     /* Remove opacity that kills contrast */
    transition: color 0.2s ease;
}

.footer__link-item:hover {
    color: var(--ifm-color-primary);
    text-decoration: underline;
}

.footer__title {
    color: #ffffff; /* Pure white for headers */
    opacity: 1;
}

.footer__copyright {
    color: #dcdcdc; /* Light grey for text */
    opacity: 1;
}

/* PERFORMANCE FIX (Goal: FCP < 1.0s) */
/* Forces system fonts to load immediately without waiting */
@font-face {
  font-family: 'system-ui';
  font-style: normal;
  font-weight: 400;
  src: local(".SFNS-Regular"), local(".SFNSText-Regular"), local(".HelveticaNeueDeskInterface-Regular"), local(".LucidaGrandeUI"), local("Segoe UI"), local("Ubuntu"), local("Roboto-Regular"), local("DroidSans"), local("Tahoma");
  font-display: swap;
}


/* SIDEBAR LEVEL 2 COLOR FIX */
/*
I noticed that after disabling the "generated-index" link, these sub-categories
defaulted to a stark white color (active state)
I forced the standard neutral menu color here to ensure visual consistency
across the entire navigation tree.
*/
.theme-doc-sidebar-item-category-level-2 > div > .menu__link,
.theme-doc-sidebar-item-category-level-2 > div > .menu__link--active {
    color: var(--ifm-menu-color) !important;
    background-color: transparent !important;
    font-weight: 600;
}


/* MOBILE LAYOUT ADAPTATION (Immersive layout + Reader mode + Enhanced TOC) */
/*
   * Strategy: "Card deconstruction" & "Native app feel"
   * I opted for the same solution adopted in the "Telephone Number Validator" project.
   * Recent user testing revealed that the "card" container felt awkward and
   * anti-aesthetic on mobile, even if it didn't consume much width
   * The goal is to eliminate the card metaphor to achieve a layout similar
   * to a native app:
   * 1. Immersive layout: Maximizing screen real estate by removing borders/margins
   * 2. Reader mode: Reducing vertical noise by hiding breadcrumbs
   * 3. Enhanced TOC (Table Of Contents): Visually separating the navigation from the
   * body text.
*/
@media screen and (max-width: 996px) {

    :root {
        --ifm-navbar-shadow: none; /* I removed the shadow because it looked heavy on mobile, and I also believe that a simple separator line slightly thicker is enough, as learned in Refactoring UI */
    }
    
    [data-theme='dark'] {
        --ifm-navbar-shadow: none;
    }
    
    /* Reset wrapper: Removing the box container to prevent overflow & remove the gap */
    .main-wrapper {
        margin: 0 !important;
        padding-top: 0 !important; /* Set to 0 since breadcrumbs are removed */
        border: none !important;
        border-radius: 0 !important;
        width: 100% !important;
        max-width: 100vw !important; 
        overflow-x: hidden !important; 
    }

    /* Reset navbar: Allowing it to touch the physical edges of the screen */
    .navbar {
        margin: 0 !important;
        border-radius: 0 !important;
        border-left: none !important;
        border-right: none !important;
        border-top: none !important;
        border-bottom: 1.7px solid var(--card-border-color) !important; /* I increased the border to make the separation clearer since I removed the shadow in this mobile version */
    }
    
    /* Safety: Restoring internal padding so the text doesn't hit the bezel */
    /* Chosen 6px here to maximize the reading width */
    .container {
        padding-left: 6px !important;
        padding-right: 6px !important;
        max-width: 100% !important;
    }
    
    /* Fix for the row negative margins creating side scroll */
    .row {
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    /* Hiding breadcrumbs to save vertical space */
    .breadcrumbs {
        display: none !important;
    }
    
    /* TOC ENHANCEMENTS (Accordion) */
    .theme-doc-toc-mobile {
        /* Width trick: Using negative margins to pull the element to the screen edges
           With -12px creating a visual breakout relative to the container padding */
        margin-left: -12px !important;
        margin-right: -12px !important;
        width: calc(100% + 24px) !important; 
        margin-bottom: 2rem !important; /* Space required before content starts */
    }

}


/* LANDSCAPE OPTIMIZATION */
/*
   * When rotating the device to landscape, vertical height becomes scarce
   * The standard navbar consumes too much viewport, so I forcing a compact
   * height specifically for this orientation.
*/
@media screen and (max-width: 996px) and (orientation: landscape) {
    
    :root {
        /* Reducing navbar height here (Default is 60px) */
        --ifm-navbar-height: 50px;
    }

}